<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: Svc/CmdSequencer/docs/sdd.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F´ Flight Software - C/C++ Documentation
   &#160;<span id="projectnumber">NASA-v1.6.0</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_svc_2_cmd_sequencer_2docs_2sdd_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Svc/CmdSequencer/docs/sdd.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_svc_2_cmd_sequencer_2docs_2sdd_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;\page SvcCmdSequencerComponent Svc::CmdSequencer Component</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# Svc::CmdSequencer Component</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;## 1 Introduction</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The command sequencer is a component that iterates through a set of commands contained in binary form in a file located in a file system available to the sequencer. A command to the sequencer specifies the file to execute. The file can contain commands that execute immediately, after a delay, or at an absolute time. The sequence will abort if any given command in the sequence returns a failed status.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;## 2 Requirements</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;The requirements for `Svc::CmdSequencer` are as follows:</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;Requirement | Description | Verification Method | Rationale</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;----------- | ----------- | ------------------- | -------- </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;ISF-CMDS-001 | The `Svc::CmdSequencer` component shall read sequence files. | Unit Test | CmdSequencer gets commands from the sequence file.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;ISF-CMDS-002 | The `Svc::CmdSequencer` component shall validate the sequence files with a CRC. | Unit Test | CmdSequencer need to know it has a valid file.</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;ISF-CMDS-003 | The `Svc::CmdSequencer` component shall provide a command to validate the sequence file. | Unit Test | Waiting to validate the file only when running it can cause operational issues</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;ISF-CMDS-004 | The `Svc::CmdSequencer` component shall cancel the sequence upon receiving a failed command status. | Unit Test | A sequence should not continue if a command fails since subsequent commands may depend on the outcome</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;ISF-CMDS-005 | The `Svc::CmdSequencer` component shall provide a command to cancel the existing sequence | Unit Test | Operator should be able to cancel the sequence if it is hung or needs to be stopped. </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;ISF-CMDS-006 | The `Svc::CmdSequencer` component shall provide an overall sequence timeout. | Unit Test | Sequencer should quit if a component fails to send a command response</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;## 3 Design</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;### 3.1 Component Context</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;![Component IBD](img/CmdSequencerIBD.jpg)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;### 3.2 Component Interface</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;![Component BDD](img/CmdSequencerBDD.jpg)</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;#### 3.2.1 Port description table</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;Port Name|Type|Direction|Usage</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;---------|----|---------|-----</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;cmdRegOut|Fw::CmdReg|output|Framework command registration</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;cmdIn|Fw::Cmd|input|Framework command input port</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;cmdResponseOut|Fw::CmdResponse|output|Framework command status port</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;logOut|Fw::Log|output|Framework binary log output port</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;LogText|Fw::LogText|output|Framework text log output port</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;tlmOut|Fw::Tlm|output|Framework telemetry port</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;timeCaller|Fw::Time|output|Framework time port</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;pingIn|Svc::Ping|async input|Input ping call</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;pingOut|Svc::Ping|output|Reply for ping</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;schedIn|Svc::Sched|async input|Scheduler input - timed commands will be checked</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;comCmdOut|Fw::Com|output|Sends command buffers for each command in sequence</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;cmdResponseIn|Fw::CmdResponse|asyc input|Received status of last dispatched command</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;seqRunIn|Svc::CmdSeqIn|async input|Receives requests for running sequences from other components</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;seqDone|Fw::CmdResponse|output|outputs status of sequence run; meant to be used with `seqRunIn`</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;#### 3.2.2 Command Handlers</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;##### 3.2.2.1 CS_Validate</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;The `CS_Validate` command will validate that the format and checksum of a sequence file are correct without executing any commands in the file. This allows operators to validate a file prior to executing it.</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;##### 3.2.2.2 CS_Run</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;The `CS_Run` command will execute a sequence. If a prior sequence is still running, it will be canceled. If a command returns a failed status, the sequence will be aborted.</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;##### 3.2.2.3 CS_Cancel</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;The `CS_Cancel` command will cancel an existing sequence. If there is no sequence currently executing, the command will emit a warning event but not fail.</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;##### 3.2.2.4 CS_Manual</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;The `CS_Manual` command will put the sequencer in a manual stepping mode, where the commands will be advanced by the `CS_Step` command. After entering this mode, the operator should issue a `CS_Run` command to load the sequence. In this mode, the sequence will be validated and loaded, but will not execute any commands until receiving the `CS_Start` command</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;##### 3.2.2.5 CS_Start</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;The `CS_Start` command will execute the first command in the sequence in manual mode.</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;##### 3.2.2.6 CS_Step</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;The `CS_Step` command will execute subsequent commands after receiving the `CS_Start` command.</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;##### 3.2.2.7 CS_Auto</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;The `CS_Auto` command will change the sequencing mode from manual to automatic, which means that the sequencer will automatically execute commands upon loading. This command can only be run when there are no currently executing sequences. If a sequence is executing, a `CS_Cancel` followed by a `CS_Auto` will get the sequencer back to executing sequences automatically.</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;#### 3.2.3 Port Handlers</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;##### 3.2.3.1 schedIn</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;The `schedIn` port checks to see if there is a timed command pending. If the timer for a pending command has expired, the command is dispatched. If there is a command being executed, the command timeout timer is also checked. If it has expired, a warning event is emitted and the sequence is aborted.</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;##### 3.2.3.2 cmdResponseIn</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;The `cmdResponseIn` port is called when a command in a sequence is completed. If the command status is successful, the next command in the sequence is executed.</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;&lt;a name=&quot;seqRunIn&quot;&gt;&lt;/a&gt;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;##### 3.2.3.3 seqRunIn</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;This port takes a single argument `filename` of type `Fw::EightyCharString`. In</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;general, sending `filename` on this port has the same  effect as issuing</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;a `CS_Run` command with `filename` as the file name argument.</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;If `filename` is empty, then `CmdSequencer` runs the sequence stored in the</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;sequence buffer, without loading a sequence first. In order for this to work:</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;* You must already have called [`loadSequence`](#loadSequence).</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;* There must be a valid sequence in the buffer, i.e., `loadSequence` must have succeeded.</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;* You must not have validated or run any sequences since calling `loadSequence`, since</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;these operations clear the buffer.</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;##### 3.2.3.4 pingIn</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;The `pingIn` port is called by the `Svc::Health` component to verify that the `CmdSequencer` thread is still functional. The handler simply takes the provided code and calls the `pingOut` port. </div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;### 3.3 Component Structure</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;#### 3.3.1 Types</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;The `CmdSequencer` class defines the following types:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;* &lt;a name=&quot;Sequence&quot;&gt;`Sequence`&lt;/a&gt;: </div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;An abstract class representing a command sequence.</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;It provides the following pure virtual functions, which</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;its concrete subclasses must implement:</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    * `loadFile`: Open a named sequence file from the disk and</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;validate the file. Fill in the member variable</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;`m_header` of type [`Sequence::Header`](#Sequence_Header)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;with the header information for the current sequence.</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    * `hasMoreRecords:` Return true if and only if there are more records</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;available in the current sequence.</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    * `nextRecord`: Return a [`Sequence::Record`](#Sequence_Record)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;object corresponding to the next record of the current sequence.</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;This function should succeed if `hasMoreRecords` returns `true`;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;otherwise it should assert.</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    * `reset`: Reset the current sequence to the beginning.</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;After calling this function, `hasMoreRecords` should return `true`,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;unless the sequence has zero records.</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    * `clear`: Clear the current sequence.</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;After calling this function, `hasMoreRecords` should return `false`.</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;* &lt;a name=&quot;Sequence_Header&quot;&gt;`Sequence::Header`&lt;/a&gt;: </div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;A class representing a sequence header.</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;It contains member variables corresponding to the header fields</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;of the [F Prime sequence format](#F_Prime_Sequence_Format).</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;* &lt;a name=&quot;Sequence_Record&quot;&gt;`Sequence::Record`&lt;/a&gt;: </div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;A class representing a sequence record.</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;It contains member variables corresponding to the record fields</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;of the [F Prime sequence format](#F_Prime_Sequence_Format).</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;* &lt;a name=&quot;F_Prime_Sequence&quot;&gt;`FPrimeSequence`&lt;/a&gt;: </div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;A concrete subclass of [`Sequence`](#Sequence)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;that implements the virtual functions as follows:</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    * `loadFile`: Open a named sequence file from the disk.</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;Read, deserialize, and store the header.</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;Read the binary records into a serial buffer *B*.</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;Extract the stored CRC from the file.</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;Check that the file format is valid according to the binary format</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;specified in [**F Prime Sequence Format**](#F_Prime_Sequence_Format).</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;Compute the CRC value of the binary header and records</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;and check it against the stored CRC value.</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    * `hasMoreRecords`: Return `true` if and only if *B* has more data.</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    * `nextRecord`: Deserialize and return the next record stored</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;in the serial buffer.</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    * `reset`: Reset *B* for deserialization.</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    * `clear`: Reset *B* for serialization.</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;#### 3.3.2 Configuration</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;##### 3.3.2.1 setTimeout (Optional)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;The `setTimeout()` public method sets the command timeout value. When a command is being executed by a component, this value specifies a timeout in seconds that will abort the sequence if exceeded. The default value of zero means that there will be no timeout.</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;##### 3.3.2.2 setSequenceFormat (Optional)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;This function has a single argument of type [`CmdSequencer::Sequence&amp;`](#Sequence).</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;By default, `CmdSequencer` uses an instance of</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;[`FPrimeSequence`](#F_Prime_Sequence) to load and run binary sequences</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;conforming to the specification given in </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;[**F Prime Sequence Format**](#F_Prime_Sequence_Format).</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;After you call `setSequenceFormat`, `CmdSequencer` uses the object</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;passed in as its argument to load and run sequences.</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;By defining a suitable subclass of [`CmdSequencer::Sequence&amp;`](#Sequence)</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;and passing in an instance of this subclass, </div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;you can use a project-specific sequence format. You can also change</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;the internal representation for the sequence: for example, you can have</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;the `Sequence` subclass read the next record from the disk instead of loading</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;the entire sequence into memory (in this case, the `loadFile` operation would load</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;just the fixed-length header).</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;##### 3.3.2.3 allocateBuffer</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;The `allocateBuffer()` public method passes a memory allocator to provide memory for the sequence buffer needed by `cmdSequencer`. The user will provide an instance of a sub-class of `Fw::MemAllocator` that implements memory allocation. An example of this using the heap can be found in `Fw/Types/MallocAllocator.hpp`.</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;&lt;a name=&quot;loadSequence&quot;&gt;&lt;/a&gt;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;##### 3.3.2.4 loadSequence (Optional)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;This function takes a single argument `fileName` of type `Fw::EightyCharString`.</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;When you call this function, `CmdSequencer` loads the sequence file `fileName`</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;into its buffer so that you can execute it later by calling</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;[`seqRunIn`](#seqRunIn).</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;This function issues events, so you must connect the event topology before</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;calling this function.</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;##### 3.3.2.5 deallocateBuffer</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;The `deallocateBuffer()` method is used to deallocate the buffer supplied in `allocateBuffer()` method. It should be called before the destructor.</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;#### 3.3.3 Data formats</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;&lt;a name=&quot;F_Prime_Sequence_Format&quot;&gt;&lt;/a&gt;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;##### 3.3.3.1 F Prime Sequence Format</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;An F Prime sequence file consists of a header followed by a list of records and a CRC value.</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;**Header:**</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;The format for the header is as follows. All numbers must be stored in big-endian format.</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;Header Field | Size (bytes) | Description</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;------------ | ------------ | -----------</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;File Size | 4 | Size of command record buffer following header</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;Number of records | 4 | Number of records in the file</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;Time Base | 2 | Time Base for sequence (0xFFFF = don&#39;t care)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;Context | 1 | Context for sequence (project specific) 0xFF = don&#39;t care</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;**Records:**</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;The format for each record is as follows:</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;Record Field | Size (bytes) | Description</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;------------ | ------------ | -----------</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;Descriptor | 1 | What kind of record it is. 0 = absolute time command, 1 = relative time command, 2 = end of sequence</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;Command Time | 8 | Start time of command. Depending on descriptor, will be relative or absolute. First four bytes are seconds of command, second four bytes are microseconds of command.</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;Record Size | 4 | Size of command buffer</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;Command Buffer | &gt;= 4 | Buffer containing command packet descriptor, command opcode, and zero or more serialized arguments.</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;**CRC value:**</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;The last 4 bytes of the file is a CRC of the entire file as computed by Utils/Hash.hpp</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;##### 3.3.3.2 Sequence File Generator</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;A utility is provided that will convert a text file listing of commands and their argument to a binary sequence file.</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;It can be run by invoking:</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;`Gse/bin/run_tinyseqgen.sh &lt;input text file&gt;`</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;The syntax of the file is as follows:</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;`;` - Comment Character. Any text after this will be ignored. Can be anywhere on a line.</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;__Relative Time Command:__</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;`RHH:MM::SS.FFFF MNEMONIC A1,A2...AN`</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;where:</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;`R` - Relative time descriptor</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;`HH` - delay in hours</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;`MM` - delay in minutes</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;`SS` - delay in seconds</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;`.FFFF` - delay in fractions of a second (optional)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;`MNEMONIC` - Command mnemonic in dictionary</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;`A1,A2...AN` - any arguments for the command</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;__Immediate Command:__</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;A no delay command is a special case of a relative delay with zero delay specified:</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;`R00:00:00 MNEMONIC A1,A2...AN`</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;__Absolute Command:__</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;`AYYYY-DOYTHH:MM:SS.FFFF MNEMONIC A1,A2...AN`</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;where:</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;`R` - Relative time descriptor</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;`YYYY` - Year</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;`DOY` - Day of Year</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;`HH` - delay in hours</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;`MM` - delay in minutes</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;`SS` - delay in seconds</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;`.FFFF` - delay in fractions of a second (optional)</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;`MNEMONIC` - Command mnemonic in dictionary</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;`A1,A2...AN` - any arguments for the command</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;Note that the time is encoded in UTC with an epoch of 1/1/1970.</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;An example can be seen in [Gse/bin/simple_sequence.seq](../../../Gse/bin/simple_sequence.seq)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;### 3.4 Component State</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;The `CmdSequencer` does not have any significant state machines.</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;### 3.5 Component Dictionary</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;Dictionaries: [HTML](CmdSequencer.html) [MD](CmdSequencer.md)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;### 3.6 Component Sequences</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;![Execute Sequence](img/SequenceExecution.jpg)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;## 4 Module Checklists</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;[Design Checklist](Checklist_Design.xlsx)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;[Code Checklist](Checklist_Code.xlsx)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;[Unit Test Checklist](Checklist_Unit_Test.xls)</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;## 5 Unit Testing</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;[CmdSequencerImpl.cpp](../test/ut/output/CmdSequencerImpl.cpp.gcov)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;[CmdSequencerComponentAc.cpp](../test/ut/output/CmdSequencerComponentAc.cpp.gcov)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;## 6 Change log</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;Date | Change Description</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;---- | ------------------</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;2/26/2017|Version for Design/Code Review</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;4/6/2017|Version for Unit test</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;10/30/2017|Revise design to make sequence format configurable</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_svc_2_cmd_sequencer_2docs_2sdd_8md.html">sdd.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
